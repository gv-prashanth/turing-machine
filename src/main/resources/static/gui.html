<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Turning Machine</title>
<script>
	var machineUrl = "";
	function createMachine() {
		var xmlhttp = new XMLHttpRequest(); // new HttpRequest instance 
		xmlhttp.open("POST", "/turningMachine");
		xmlhttp.setRequestHeader("Content-Type", "application/json");
		xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 201) {
				machineUrl = this.getResponseHeader("Location");
				document.getElementById("manage").innerHTML = '<button type="button" onclick="runMachine()">Run a Step</button>';
			}
		};
		xmlhttp
				.send("{ \"tapeSize\": \"50\", \"actionTable\": [ { \"initialState\": 0, \"initialSymbol\": \" \", \"finalState\": 1, \"finalSymbol\": \"0\", \"moveTo\": \"R\" }, { \"initialState\": 1, \"initialSymbol\": \" \", \"finalState\": 0, \"finalSymbol\": \"1\", \"moveTo\": \"R\" } ] }");
	}
	function runMachine() {
		var xmlhttp = new XMLHttpRequest(); // new HttpRequest instance 
		xmlhttp.open("GET", machineUrl);
		xmlhttp.setRequestHeader("Content-Type", "application/json");
		xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var tape = JSON.parse(this.responseText).Tape.split("");
				var head = JSON.parse(this.responseText).Head;
				document.getElementById("runResult").innerHTML = "";
				document.getElementById("runResult").appendChild(getTapeHtmlToPrint(tape, head));
			} else if (this.readyState == 4 && this.status == 400) {
				document.getElementById("runResult").innerHTML = "Insufficient Tape!";
			} else {
				document.getElementById("runResult").innerHTML = "Invalid Machine. Please refresh the page.";
			}
		};
		xmlhttp.send();
	}
	function getTapeHtmlToPrint(tape, head){
		var tbl = document.createElement('table');
		tbl.setAttribute('border', '1');
		var tbdy = document.createElement('tbody');

			var tr = document.createElement('tr');
			for (var j = 0; j < tape.length; j++) {
				var td = document.createElement('td');
				td.setAttribute('width', '10');
				if (head == j + 1) {
					td.setAttribute('bgcolor', 'Tan');
				}
				td.innerHTML = tape[j];
				tr.appendChild(td);
			}
			tbdy.appendChild(tr);

		tbl.appendChild(tbdy);
		return tbl;
	}
	function addNewRule() {
		var table = document.getElementById("myTable");
		var row = table.insertRow(-1);
		var initialState = row.insertCell(0);
		var initialSymbol = row.insertCell(1);
		var finalState = row.insertCell(2);
		var finalSymbol = row.insertCell(3);
		var moveTo = row.insertCell(4);
		initialState.innerHTML = "<center><input type='text' size='5'/></center>";
		initialSymbol.innerHTML = "<center><input type='text' size='5'/></center>";
		finalState.innerHTML = "<center><input type='text' size='5'/></center>";
		finalSymbol.innerHTML = "<center><input type='text' size='5'/></center>";
		moveTo.innerHTML = "<select><option value='L'>Left</option><option value='R'>Right</option></select>";
	}
</script>
</head>
<body>
	<h1>Turing Machine</h1>

	<table id="myTable" border=1>
		<tr>
			<th>Initial State</th>
			<th>Initial Symbol</th>
			<th>Final State</th>
			<th>Final Symbol</th>
			<th>Direction</th>
		</tr>
	</table>
	<br>
	<div id="manage">
		<button onclick="addNewRule()">Add a Rule</button>
		<button type="button" onclick="createMachine()">Construct</button>
	</div>
	<br>
	<div id="runResult"></div>
</body>
</html>